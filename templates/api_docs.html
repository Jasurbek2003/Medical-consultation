<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Hujjatlari - Tibbiy Konsultatsiya</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: #f8f9fa;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
            border-radius: 10px;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        .section {
            background: white;
            margin: 20px 0;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section h2 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .section h3 {
            color: #555;
            margin-top: 25px;
        }
        .endpoint {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        .endpoint.post {
            border-left-color: #007bff;
        }
        .endpoint.put {
            border-left-color: #ffc107;
        }
        .endpoint.delete {
            border-left-color: #dc3545;
        }
        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.8em;
            margin-right: 10px;
        }
        .method.get { background: #28a745; color: white; }
        .method.post { background: #007bff; color: white; }
        .method.put { background: #ffc107; color: black; }
        .method.delete { background: #dc3545; color: white; }
        .url {
            font-family: monospace;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
        .nav {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .nav li a {
            color: #667eea;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid #667eea;
            border-radius: 20px;
            transition: all 0.3s;
        }
        .nav li a:hover {
            background: #667eea;
            color: white;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 10px 0;
        }
        .response-example {
            background: #f1f5f9;
            border: 1px solid #cbd5e0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.85em;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            margin-left: 5px;
        }
        .badge.new { background: #28a745; color: white; }
        .badge.updated { background: #007bff; color: white; }
        .note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .note.warning {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .note.info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header { padding: 20px 10px; }
            .header h1 { font-size: 2em; }
            .nav ul { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• API Hujjatlari</h1>
            <p>Tibbiy Konsultatsiya Tizimi REST API</p>
        </div>

        <div class="nav">
            <ul>
                <li><a href="#chat-api">üí¨ Chat API</a></li>
                <li><a href="#doctors-api">üë®‚Äç‚öïÔ∏è Shifokorlar API</a></li>
                <li><a href="#users-api">üë§ Foydalanuvchilar API</a></li>
                <li><a href="#consultations-api">üìã Konsultatsiyalar API</a></li>
                <li><a href="#examples">üí° Misollar</a></li>
            </ul>
        </div>

        <div class="note info">
            <strong>Asosiy URL:</strong> <code>http://localhost:8000/api/</code><br>
            <strong>Ma'lumotlar formati:</strong> JSON<br>
            <strong>Autentifikatsiya:</strong> Hozircha talab qilinmaydi
        </div>

        <section class="section" id="chat-api">
            <h2>üí¨ Chat API</h2>
            <p>AI chat bilan ishlash uchun API endpoint'lar</p>

            <div class="endpoint post">
                <span class="method post">POST</span>
                <span class="url">/api/chat/message/</span>
                <span class="badge new">Yangi</span>
                <p>Chat xabar yuborish va AI javob olish</p>
                <div class="code-block">
{
    "message": "Boshim og'riyapti ikki kundan beri",
    "session_id": "optional-session-id"
}
                </div>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/chat/sessions/</span>
                <p>Chat session'lar ro'yxati</p>
            </div>

            <div class="endpoint post">
                <span class="method post">POST</span>
                <span class="url">/api/chat/sessions/{id}/send_message/</span>
                <p>Mavjud session'ga xabar yuborish</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/chat/sessions/{id}/messages/</span>
                <p>Session xabarlar tarixi</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/chat/sessions/stats/</span>
                <p>Chat statistikasi</p>
            </div>

            <div class="endpoint post">
                <span class="method post">POST</span>
                <span class="url">/api/chat/feedback/</span>
                <p>Fikr-mulohaza yuborish</p>
            </div>
        </section>

        <section class="section" id="doctors-api">
            <h2>üë®‚Äç‚öïÔ∏è Shifokorlar API</h2>
            <p>Shifokorlar ma'lumotlari bilan ishlash</p>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/doctors/api/</span>
                <p>Barcha shifokorlar ro'yxati (pagination bilan)</p>
                <p><strong>Query parametrlar:</strong> specialty, region, district, search, ordering, page, page_size</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/doctors/api/{id}/</span>
                <p>Shifokor detallari</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/doctors/api/by_specialty/?specialty=stomatolog</span>
                <p>Mutaxassislik bo'yicha shifokorlar</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/doctors/api/top_rated/?limit=5</span>
                <p>Eng yuqori reytingli shifokorlar</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/doctors/api/available_now/</span>
                <p>Hozir mavjud shifokorlar</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/doctors/api/{id}/schedule/</span>
                <p>Shifokor ish jadvali</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/doctors/api/{id}/reviews/</span>
                <p>Shifokor sharhlari</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/doctors/ajax/specialties/</span>
                <p>Barcha mutaxassisliklar ro'yxati</p>
            </div>
        </section>

        <section class="section" id="users-api">
            <h2>üë§ Foydalanuvchilar API</h2>
            <p>Foydalanuvchi profili va ma'lumotlar</p>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/users/api/</span>
                <p>Foydalanuvchilar ro'yxati</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/users/api/{id}/profile/</span>
                <p>Foydalanuvchi profili</p>
            </div>

            <div class="endpoint post">
                <span class="method post">POST</span>
                <span class="url">/api/users/api/{id}/update_profile/</span>
                <p>Profilni yangilash</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/users/api/{id}/medical_history/</span>
                <p>Tibbiy tarix</p>
            </div>

            <div class="endpoint post">
                <span class="method post">POST</span>
                <span class="url">/api/users/api/{id}/add_medical_record/</span>
                <p>Tibbiy yozuv qo'shish</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/users/api/{id}/preferences/</span>
                <p>Foydalanuvchi sozlamalari</p>
            </div>
        </section>

        <section class="section" id="consultations-api">
            <h2>üìã Konsultatsiyalar API</h2>
            <p>Konsultatsiyalar va sharhlar</p>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/consultations/api/</span>
                <p>Konsultatsiyalar ro'yxati</p>
                <p><strong>Query parametrlar:</strong> patient_id, doctor_id, status, consultation_type, date_from, date_to</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/consultations/api/{id}/</span>
                <p>Konsultatsiya detallari</p>
            </div>

            <div class="endpoint post">
                <span class="method post">POST</span>
                <span class="url">/api/consultations/api/{id}/start_consultation/</span>
                <p>Konsultatsiyani boshlash</p>
            </div>

            <div class="endpoint post">
                <span class="method post">POST</span>
                <span class="url">/api/consultations/api/{id}/complete_consultation/</span>
                <p>Konsultatsiyani yakunlash</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/consultations/api/today/</span>
                <p>Bugungi konsultatsiyalar</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/consultations/api/stats/</span>
                <p>Konsultatsiya statistikasi</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/consultations/reviews/</span>
                <p>Barcha sharhlar</p>
            </div>

            <div class="endpoint get">
                <span class="method get">GET</span>
                <span class="url">/api/consultations/reviews/stats/</span>
                <p>Sharh statistikasi</p>
            </div>
        </section>

        <section class="section" id="examples">
            <h2>üí° Frontend Misollar</h2>

            <h3>JavaScript Fetch</h3>
            <div class="code-block">
// Chat xabar yuborish
async function sendMessage(message, sessionId = null) {
    const response = await fetch('/api/chat/message/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            message: message,
            session_id: sessionId
        })
    });

    return await response.json();
}

// Shifokorlarni olish
async function getDoctors(specialty = null) {
    let url = '/api/doctors/api/';
    if (specialty) {
        url += `?specialty=${specialty}`;
    }

    const response = await fetch(url);
    return await response.json();
}
            </div>

            <h3>React Hook Misoli</h3>
            <div class="code-block">
import { useState, useEffect } from 'react';

export function useChat() {
    const [sessionId, setSessionId] = useState(null);
    const [messages, setMessages] = useState([]);

    const sendMessage = async (message) => {
        const response = await fetch('/api/chat/message/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, session_id: sessionId })
        });

        const data = await response.json();
        if (data.success) {
            setSessionId(data.session_id);
            setMessages(prev => [...prev, data.user_message, data.ai_response]);
        }
        return data;
    };

    return { messages, sendMessage, sessionId };
}
            </div>

            <h3>Vue.js Composition API</h3>
            <div class="code-block">
import { ref, onMounted } from 'vue'

export function useDoctors() {
    const doctors = ref([])
    const loading = ref(false)

    const fetchDoctors = async (specialty = null) => {
        loading.value = true
        try {
            let url = '/api/doctors/api/'
            if (specialty) url += `?specialty=${specialty}`

            const response = await fetch(url)
            const data = await response.json()
            doctors.value = data.results || []
        } finally {
            loading.value = false
        }
    }

    return { doctors, loading, fetchDoctors }
}
            </div>

            <h3>Flutter/Dart Misoli</h3>
            <div class="code-block">
class ApiService {
    static const String baseUrl = 'http://localhost:8000/api';

    static Future&lt;Map&lt;String, dynamic&gt;&gt; sendChatMessage(
        String message, [String? sessionId]) async {
        final response = await http.post(
            Uri.parse('$baseUrl/chat/message/'),
            headers: {'Content-Type': 'application/json'},
            body: jsonEncode({
                'message': message,
                if (sessionId != null) 'session_id': sessionId,
            }),
        );

        return jsonDecode(response.body);
    }

    static Future&lt;List&lt;Doctor&gt;&gt; getDoctors({String? specialty}) async {
        String url = '$baseUrl/doctors/api/';
        if (specialty != null) url += '?specialty=$specialty';

        final response = await http.get(Uri.parse(url));
        final data = jsonDecode(response.body);

        return (data['results'] as List)
            .map((json) => Doctor.fromJson(json))
            .toList();
    }
}
            </div>
        </section>

        <section class="section">
            <h2>üìù Muhim Eslatmalar</h2>

            <div class="note">
                <strong>Pagination:</strong> Ko'pchilik API'lar pagination ishlatadi. <code>page</code> va <code>page_size</code> parametrlarini ishlating.
            </div>

            <div class="note info">
                <strong>Vaqt formati:</strong> Barcha vaqtlar UTC formatida. Frontend'da mahalliy vaqtga o'tkazing.
            </div>

            <div class="note warning">
                <strong>Xatoliklar:</strong> Barcha xatoliklar JSON formatida qaytariladi. <code>success</code> maydonini tekshiring.
            </div>

            <div class="note">
                <strong>CORS:</strong> Frontend'dan ishlash uchun CORS sozlamalarini tekshiring.
            </div>
        </section>

        <section class="section">
            <h2>üîó Foydali Havolalar</h2>
            <ul>
                <li><a href="/admin/" target="_blank">Admin Panel</a></li>
                <li><a href="/chat/" target="_blank">Chat Interface Test</a></li>
                <li><a href="/doctors/list/" target="_blank">Shifokorlar Ro'yxati</a></li>
                <li><a href="https://www.django-rest-framework.org/" target="_blank">Django REST Framework Hujjatlari</a></li>
            </ul>
        </section>
    </div>
</body>
</html>